(()=>{"use strict";class e{constructor(){this.ship=null,this.discovered=!1}setDiscovered(){this.discovered=!0}setShip(e){this.ship=e}getShip(){return this.ship}getDiscovered(){return this.discovered}hasShip(){return null!==this.ship}}function t(e){return Math.floor(Math.random()*e)}class s{constructor(){this.board=this.fillBoard(),this.aliveShips=[],this.takenSpots=[]}fillBoard(){const t=[];for(let e=0;e<10;e++)t.push([]);return t.forEach((t=>{for(let s=0;s<10;s++)t.push(new e)})),t}getShips(){return this.aliveShips}getBoard(){return this.board}getTileAt(e,t){return this.board[e][t]}placeShip(e,t){e.forEach((e=>{const[s,r]=e;this.board[s][r].setShip(t.getName()),this.takenSpots.push([s,r])})),this.aliveShips.push(t)}placeShipX(e,s,r){let o,a,i,n;if(void 0===s&&void 0===r||null===s&&null===r)do{o=t(10),a=t(10),n=[],i=o;for(let t=0;t<e.shipLength;t++)n.push([o,a]),o--}while(this.isOutOfBounds(i,e.shipLength)||this.isAlreadyTaken(n));else{n=[];for(let t=0;t<e.shipLength;t++)n.push([s,r]),s--}this.placeShip(n,e)}placeShipY(e,s,r){let o,a,i=s,n=r;if(void 0===s&&void 0===r||null===s&&null===r)do{i=t(10),n=t(10),a=[],o=n;for(let t=0;t<e.shipLength;t++)a.push([i,n]),n--}while(this.isOutOfBounds(o,e.shipLength)||this.isAlreadyTaken(a));else{a=[];for(let t=0;t<e.shipLength;t++)a.push([s,r]),r--}this.placeShip(a,e)}isAlreadyTaken(e){let t=!1;return this.takenSpots.forEach((s=>{const[r,o]=s;e.forEach((e=>{const[s,a]=e;r===s&&o===a&&(t=!0)}))})),t}isOutOfBounds(e,t){return e-t<0||e>10}receiveAttack(e,t){this.board[e][t].setDiscovered(),this.board[e][t].hasShip()&&this.aliveShips.find((s=>s.getName()===this.board[e][t].getShip())).hit()}isAllShipSunk(){let e=!0;return this.aliveShips.forEach((t=>{t.isSunk()||(e=!1)})),e}restartBoard(){this.board=this.fillBoard(),this.aliveShips=[],this.takenSpots=[]}}class r{constructor(e,t){this.shipName=e,this.shipLength=t,this.numberOfHits=0,this.sunk=!1}getName(){return this.shipName}getLength(){return this.shipLength}getHits(){return this.numberOfHits}hit(){this.numberOfHits+=1,this.numberOfHits===this.shipLength&&(this.sunk=!0)}isSunk(){return this.sunk}}const o=[["carrier",5],["battleship",4],["cruiser",3],["submarine",3],["destroyer",2]];class a{constructor(){this.playerBoard=new s}getBoard(){return this.playerBoard}addShips(){o.forEach((e=>{const[t,s]=e,o=new r(t,s);0===Math.floor(2*Math.random())?this.getBoard().placeShipX(o):this.getBoard().placeShipY(o)}))}redeployShips(){this.getBoard().restartBoard(),this.addShips()}}class i extends a{constructor(e){super(),this.playerName=e}setPlayerName(e){this.playerName=e}getPlayerName(){return this.playerName}}class n extends a{constructor(){super(),this.previousMoves=[]}getRandomMove(){for(;;){const e=[t(10),t(10)];if(!this.previousMoves.some((t=>JSON.stringify(t)===JSON.stringify(e))))return this.previousMoves.push(e),e}}}function d(e,t){const s=t.querySelectorAll("div");0!==s.length&&s.forEach((e=>e.remove())),e.forEach(((e,s)=>{e.forEach(((e,r)=>{const o=document.createElement("div");o.dataset.row=s,o.dataset.col=r,e.hasShip()?o.dataset.ship=e.ship:o.dataset.ship="none",t.appendChild(o)}))}))}(()=>{const e=new i("null"),t=new n,s=document.querySelector(".editContainer"),a=o,h=s=>{const r=document.querySelector(".playerBoard"),o=document.querySelector(".computerBoard"),a=document.querySelector(".shuffle"),i=document.querySelector(".start");b(s),t.addShips(),d(e.getBoard().board,r),d(t.getBoard().board,o),B(),A(),a.addEventListener("click",y),i.addEventListener("click",p)},c=t=>{const o=document.querySelectorAll(".editContainer > div"),i=t[0][1],n=t[0][0];let h="X";window.addEventListener("keydown",(e=>{h=" "===e.key&&"X"===h?"Y":"X"})),o.forEach((t=>{t.addEventListener("mouseover",(()=>{l(+t.dataset.row,+t.dataset.col,i,h)})),t.addEventListener("click",(()=>{const o=new r(n,i);"X"===h?e.getBoard().placeShipX(o,+t.dataset.row,+t.dataset.col):e.getBoard().placeShipY(o,+t.dataset.row,+t.dataset.col),d(e.getBoard().board,s),a.length>1&&(a.shift(),c(a))}))}))},l=(t,s,r,o)=>{const a=document.querySelectorAll(".editContainer > div"),i=[],n=t,d=s;for(let e=0;e<r;e++)i.push([t,s]),"X"===o?t--:s--;u(a),"X"===o&&e.getBoard().isOutOfBounds(n,r-1)||"Y"===o&&e.getBoard().isOutOfBounds(d,r-1)||i.forEach((e=>{const[t,s]=e;a.forEach((e=>{t===+e.dataset.row&&s===+e.dataset.col&&e.classList.add("hasShip")}))}))},u=e=>{e.forEach((e=>{"none"===e.dataset.ship&&e.classList.remove("hasShip")}))},p=()=>{m(),L()},m=()=>{const s=w(),r=s=>{const o=s.currentTarget;k(o),t.getBoard().receiveAttack(o.dataset.row,o.dataset.col),N(),o.removeEventListener("click",r),g(t,e.getPlayerName())||S()};s.forEach((e=>{e.addEventListener("click",r)}))},S=()=>{setTimeout((()=>{const[s,r]=t.getRandomMove();e.getBoard().receiveAttack(s,r),E(s,r),g(e,"Computer")||O()}),0)},g=(e,t)=>!!e.getBoard().isAllShipSunk()&&(document.querySelector(".winner").innerHTML=`Winner: ${t}`,v(),!0),v=()=>{N(),document.querySelector(".endgame").classList.add("showEndgame"),document.querySelector(".endgame > .restart").addEventListener("click",(()=>{f()}))},f=()=>{e.getBoard().restartBoard(),t.getBoard().restartBoard(),h(e.getPlayerName()),document.querySelector(".endgame").classList.remove("showEndgame"),O()},y=()=>{const t=document.querySelector(".playerBoard");e.redeployShips(),d(e.getBoard().board,t),A()},B=()=>{document.querySelector(".controls").classList.remove("hideControls")},L=()=>{document.querySelector(".controls").classList.add("hideControls")},E=(e,t)=>{q().forEach((s=>{+s.dataset.row===e&&+s.dataset.col===t&&k(s)}))},k=e=>{"none"!==e.dataset.ship?e.classList.add("shipHit"):e.classList.add("discovered")},q=()=>document.querySelectorAll(".playerBoard > div"),w=()=>document.querySelectorAll(".computerBoard > div"),b=t=>{0!==t.length&&(e.setPlayerName(t),document.querySelector(".playerName").innerHTML=t)},N=()=>{document.querySelector(".computerBoard").style.pointerEvents="none"},O=()=>{document.querySelector(".computerBoard").style.pointerEvents="auto"},A=()=>{q().forEach((e=>{"none"!==e.dataset.ship&&e.classList.add("hasShip")}))};return{start:()=>{const t=document.querySelector(".prompt"),r=document.querySelector(".submitPrompt"),o=document.querySelector("#name");d(e.getBoard().board,s),c(a),t.classList.add("showPrompt"),r.addEventListener("click",(()=>{0!==o.value.length&&0!==a.length&&(h(o.value),t.classList.remove("showPrompt"))}))}}})().start()})();