(()=>{"use strict";class e{constructor(){this.ship=null,this.discovered=!1}setDiscovered(){this.discovered=!0}setShip(e){this.ship=e}getShip(){return this.ship}getDiscovered(){return this.discovered}hasShip(){return null!==this.ship}}function t(e){return Math.floor(Math.random()*e)}class s{constructor(){this.board=this.fillBoard(),this.aliveShips=[],this.takenSpots=new Set}fillBoard(){const t=[];for(let e=0;e<10;e++)t.push([]);return t.forEach((t=>{for(let s=0;s<10;s++)t.push(new e)})),t}getShips(){return this.aliveShips}getBoard(){return this.board}getTileAt(e,t){return this.board[e][t]}getSpots(){return this.takenSpots}getCoordinatesX(e,t,s){const r=[];for(let o=0;o<s;o++)r.push([e,t]),e--;return r}getCoordinatesY(e,t,s){const r=[];for(let o=0;o<s;o++)r.push([e,t]),t--;return r}placeShip(e,t){e.forEach((e=>{const[s,r]=e;this.board[s][r].setShip(t.getName()),this.addSorroundingTiles(s,r)})),this.aliveShips.push(t)}addSorroundingTiles(e,t){this.getSorroundingTiles(e,t).forEach((e=>{const[t,s]=e;this.getSpots().add(`${t}-${s}`)}))}getSorroundingTiles(e,t){const s=[[e,t]];return[[1,0],[0,1],[1,1],[-1,0],[0,-1],[-1,1],[1,-1],[-1,-1]].forEach((r=>{const[o,i]=r;this.getSpots().has(`${e+o}-${t+i}`)||s.push([e+o,t+i])})),s}placeShipX(e,s,r){let o,i,a;if(void 0===s&&void 0===r||null===s&&null===r)do{o=t(10),i=t(10),a=this.getCoordinatesX(o,i,e.shipLength)}while(this.isOutOfBounds(o,e.shipLength)||this.isAlreadyTaken(a));else a=this.getCoordinatesX(s,r,e.shipLength);this.placeShip(a,e)}placeShipY(e,s,r){let o,i,a;if(void 0===s&&void 0===r||null===s&&null===r)do{o=t(10),i=t(10),a=this.getCoordinatesY(o,i,e.shipLength)}while(this.isOutOfBounds(i,e.shipLength)||this.isAlreadyTaken(a));else a=this.getCoordinatesY(s,r,e.shipLength);this.placeShip(a,e)}isAlreadyTaken(e){let t=!1;return e.forEach((e=>{const[s,r]=e;this.getSpots().has(`${s}-${r}`)&&(t=!0)})),t}isOutOfBounds(e,t){return e-t<0||e>10}receiveAttack(e,t){this.board[e][t].setDiscovered(),this.board[e][t].hasShip()&&this.aliveShips.find((s=>s.getName()===this.board[e][t].getShip())).hit()}isAllShipSunk(){let e=!0;return this.aliveShips.forEach((t=>{t.isSunk()||(e=!1)})),e}restartBoard(){this.board=this.fillBoard(),this.aliveShips=[],this.takenSpots=new Set}}class r{constructor(e,t){this.shipName=e,this.shipLength=t,this.numberOfHits=0,this.sunk=!1}getName(){return this.shipName}getLength(){return this.shipLength}getHits(){return this.numberOfHits}hit(){this.numberOfHits+=1,this.numberOfHits===this.shipLength&&(this.sunk=!0)}isSunk(){return this.sunk}}const o=[["carrier",5],["battleship",4],["cruiser",3],["submarine",3],["destroyer",2]];class i{constructor(){this.playerBoard=new s}getBoard(){return this.playerBoard}addShips(){const e=o;this.getBoard().restartBoard(),e.forEach((e=>{const[t,s]=e,o=new r(t,s);0===Math.floor(2*Math.random())?this.getBoard().placeShipX(o):this.getBoard().placeShipY(o)}))}redeployShips(){this.getBoard().restartBoard(),this.addShips()}}class a extends i{constructor(e){super(),this.playerName=e}setPlayerName(e){this.playerName=e}getPlayerName(){return this.playerName}}class n extends i{constructor(){super(),this.previousMoves=[]}getRandomMove(){for(;;){const e=[t(10),t(10)];if(!this.previousMoves.some((t=>JSON.stringify(t)===JSON.stringify(e))))return this.previousMoves.push(e),e}}resetMoves(){this.previousMoves=[]}}function d(e,t){const s=t.querySelectorAll("div");0!==s.length&&s.forEach((e=>e.remove())),e.forEach(((e,s)=>{e.forEach(((e,r)=>{const o=document.createElement("div");o.dataset.row=s,o.dataset.col=r,e.hasShip()?o.dataset.ship=e.ship:o.dataset.ship="none",t.appendChild(o)}))}))}const c=e=>{e.querySelectorAll("div").forEach((e=>{"none"!==e.dataset.ship&&e.classList.add("hasShip")}))},h=()=>{document.querySelector(".computerBoard").style.pointerEvents="auto"},l=()=>{document.querySelector(".computerBoard").style.pointerEvents="none"},u=e=>{0!==e.length&&(document.querySelector(".playerName").innerHTML=e)},p=e=>{"none"!==e.dataset.ship?e.classList.add("shipHit"):e.classList.add("discovered")},g=()=>{document.querySelector(".controls").classList.remove("hideControls")},S=()=>{document.querySelector(".controls").classList.add("hideControls")},m=()=>{document.querySelector(".endgame").classList.remove("showEndgame")},v=()=>{document.querySelector(".endgame").classList.add("showEndgame")},y=e=>{document.querySelector(".winner").innerHTML=`Winner: ${e}`},f=(e,t)=>{e.forEach((e=>{"none"===e.dataset.ship&&e.classList.remove(t)}))},B=()=>{document.querySelector(".prompt").classList.remove("showPrompt")},L=()=>{document.querySelector(".prompt").classList.add("showPrompt")},E=()=>{document.querySelector(".warning").innerHTML="Please ensure that you placed all your ships and entered your name"};(()=>{const e=new a("null"),t=new n,s=document.querySelector(".editContainer");let i=JSON.parse(JSON.stringify(o));const k=()=>{const e=document.querySelector("#name");0!==e.value.length&&1===i.length?(q(e.value),B()):E()},q=s=>{const r=document.querySelector(".playerBoard"),o=document.querySelector(".computerBoard");u(s),e.setPlayerName(s),t.addShips(),d(e.getBoard().board,r),d(t.getBoard().board,o),g(),c(r),b()},w=()=>{i=JSON.parse(JSON.stringify(o)),e.getBoard().restartBoard(),L(),d(e.getBoard().board,s),N(i)},b=()=>{const e=document.querySelector(".shuffle"),t=document.querySelector(".start"),s=document.querySelector(".edit");e.addEventListener("click",$),t.addEventListener("click",M),s.addEventListener("click",w)},N=e=>{const t=document.querySelectorAll(".editContainer > div"),s=document.querySelector(".changeAxis"),r=e[0][1],o=e[0][0];let i="X";window.addEventListener("keydown",(e=>{i=" "===e.key&&"X"===i?"Y":"X"})),s.addEventListener("click",(()=>{i="X"===i?"Y":"X"})),t.forEach((e=>{e.addEventListener("mouseover",(()=>{A(+e.dataset.row,+e.dataset.col,r,i)})),e.addEventListener("click",(()=>{O(i,o,r,e)}))}))},O=(t,o,a,n)=>{const h=+n.dataset.row,l=+n.dataset.col,u=new r(o,a);let p=!1;if("X"===t){const s=e.getBoard().getCoordinatesX(h,l,a);C(h,l,t,a,s)&&(e.getBoard().placeShipX(u,h,l),p=!0)}else if("Y"===t){const s=e.getBoard().getCoordinatesY(h,l,a);C(h,l,t,a,s)&&(e.getBoard().placeShipY(u,h,l),p=!0)}p&&(d(e.getBoard().board,s),c(s),i.length>1&&(i.shift(),N(i)))},A=(e,t,s,r)=>{const o=document.querySelectorAll(".editContainer > div"),i=[],a=e,n=t;for(let o=0;o<s;o++)i.push([e,t]),"X"===r?e--:t--;f(o,"hasShip"),f(o,"warning");let d=C(a,n,r,s,i);i.forEach((e=>{const[t,s]=e;o.forEach((e=>{const r=t===+e.dataset.row&&s===+e.dataset.col,o=e.classList.contains("hasShip");r&&d?e.classList.add("hasShip"):!r||d||o||e.classList.add("warning")}))}))},C=(t,s,r,o,i)=>{const a="X"===r&&e.getBoard().isOutOfBounds(t,o-1),n="Y"===r&&e.getBoard().isOutOfBounds(s,o-1),d=e.getBoard().isAlreadyTaken(i);return!(a||n||d)},M=()=>{X(),S()},X=()=>{const s=D(),r=s=>{const o=s.currentTarget;p(o),t.getBoard().receiveAttack(o.dataset.row,o.dataset.col),l(),o.removeEventListener("click",r),Y(t,e.getPlayerName())||T()};s.forEach((e=>{e.addEventListener("click",r)}))},T=()=>{setTimeout((()=>{const[s,r]=t.getRandomMove();e.getBoard().receiveAttack(s,r),J(s,r),Y(e,"Computer")||h()}),0)},Y=(e,t)=>!!e.getBoard().isAllShipSunk()&&(H(t),!0),H=e=>{l(),v(),y(e),document.querySelector(".endgame > .restart").addEventListener("click",P)},P=()=>{e.getBoard().restartBoard(),t.getBoard().restartBoard(),t.resetMoves(),e.addShips(),q(e.getPlayerName()),m(),h()},$=()=>{const t=document.querySelector(".playerBoard");e.redeployShips(),d(e.getBoard().board,t),c(t)},J=(e,t)=>{x().forEach((s=>{+s.dataset.row===e&&+s.dataset.col===t&&p(s)}))},x=()=>document.querySelectorAll(".playerBoard > div"),D=()=>document.querySelectorAll(".computerBoard > div");return{start:()=>{const e=document.querySelector(".submitPrompt");w(),e.addEventListener("click",k)}}})().start()})();